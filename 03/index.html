<!DOCTYPE html>
<html lang="ru">
<head>
	<title>СУБД. Лекция 3</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="Hugo 0.119.0">
	
	<link rel="icon" href="../common/lecture.png" />
	
	<link rel="stylesheet" href="../shower/themes/ribbon/styles/screen-16x10.css">
	<link rel="stylesheet" href="../css/style.css">
	<link rel="stylesheet" href="../highlight.js/styles/idea.min.css">
</head>
<body class="shower list no-math">
	<header class="caption">
		<h1>СУБД. Лекция 3</h1>
	</header>
	
<section class="slide white" style="padding: 0" id="cover">
    <svg
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="-10 -10 895 645"
            width="100%"
            height="100%"
            style="background-image: url(../park.mail.ru/img/back.png)"
            version="1.1">
        <image
                xlink:href="../park.mail.ru/img/blocks.svg"
                width="718"
                height="548"
                preserveAspectRatio="none"
                x="157"
                y="67"/>
		<image
                xlink:href="../park.mail.ru/img/logo.svg"
                width="297"
                height="130"
                preserveAspectRatio="none"
                x="0"
                y="0"/>
        <g style="font-family: 'PF Isotext Pro', sans-serif; font-size: 32px; font-stretch: semi-condensed">
            <foreignObject x="177" y="204" width="514" height="202">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: center">
                    <div style="vertical-align: middle; display: table-cell; padding-bottom: 20px; font-weight: bold">
                        СУБД
                    </div>
                </div>
            </foreignObject>
            <foreignObject x="534" y="534" width="326" height="65">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: center; font-size: 28px">
                    <div style="vertical-align: middle; display: table-cell; font-size: 22px;">
                        Стрелков Никита
                    </div>
                </div>
            </foreignObject>
            <foreignObject x="177" y="465" width="240" height="134">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: left">
                    <div style="vertical-align: top; display: table-cell">
                        Лекция 3
                    </div>
                </div>
            </foreignObject>
        <g>
    </svg>
</section>

	<section class="slide">
    <h2>Выборка данных</h2>
    <ul>
        <li>Выборка данных:
            <ul>
                <li>Подзапросы;</li>
                <li>UNION;</li>
                <li>Еще раз про JOIN-ы;</li>
                <li>Рекурсивные запросы.</li>
            </ul>
        </li>
        <li>Иерархические структуры в базах данных.</li>
        <li>Примеры составления запросов.</li>
    </ul>
</section>

<section class="slide">
    <h2>Организационные моменты</h2>
    <ul>
        <li>Не забывайте отмечаться на лекциях!</li>
        <li>Оставляйте обратную связь по завершению лекции!</li>
    </ul>
</section>

<section class="slide">
    <h2 class="shout">Выборка данных</h2>
</section>

<section class="slide">
    <h2>SELECT</h2>
    <pre style="font-size: 70%"><code class="sql">[ WITH [ RECURSIVE ] with_query [, ...] ]
SELECT [ ALL | DISTINCT [ ON ( expression [, ...] ) ] ]
    [ * | expression [ [ AS ] output_name ] [, ...] ]
    [ FROM from_item [, ...] ]
    [ WHERE condition ]
    [ GROUP BY grouping_element [, ...] ]
    [ HAVING condition [, ...] ]
    [ { UNION | INTERSECT | EXCEPT } [ ALL | DISTINCT ] select ]
    [ ORDER BY expression [ ASC | DESC | USING operator ] [, ...] ]
    [ LIMIT { count | ALL } ]
    [ OFFSET start [ ROW | ROWS ] ]
    [ FETCH { FIRST | NEXT } [ count ] { ROW | ROWS } ONLY ]
    [ FOR { UPDATE | NO KEY UPDATE | SHARE | KEY SHARE }
        [ OF table_name [, ...] ] [ NOWAIT | SKIP LOCKED ] [...] ]
</code></pre>
</section>

<section class="slide">
    <h2>FROM. Типы таблиц</h2>
    <img src="types.jpg" style="float: right"/>
    <ul>
        <li>Постоянные таблицы</li>
        <li>Временные таблицы</li>
        <li>Виртуальные таблицы (представления)</li>
        <li>Подзапросы (вложенные запросы)</li>
    </ul>
</section>

<section class="slide">
    <h2>WHERE. Фильтрация</h2>
    <img src="filter.jpg" style="float: right" width="400px"/>
    <ul class="compact">
        <li>=</li>
        <li>!=, &lt;&gt;</li>
        <li>&gt;, &lt;, &gt;=, &lt;=</li>
        <li>OR, AND, NOT</li>
        <li>a BETWEEN x AND y</li>
        <li>a IN (x, y, z...)</li>
        <li>a LIKE p (_, %)</li>
    </ul>
    <pre><code class="sql next">SELECT *
FROM persons
WHERE department_id IN (
    SELECT id FROM departments WHERE company_id = 42
)</code></pre>
</section>

<section class="slide">
    <h2>CASE</h2>
    <img src="case.png" height="250px" style="position: absolute; right: 50px"/>
    <div style="font-size: 90%">
    <pre><code class="sql">CASE WHEN condition THEN result
     [WHEN ...]
     [ELSE result]
END</code></pre>
        <pre><code class="sql">NULLIF(value1, value2)</code></pre>
        <pre><code class="sql">GREATEST(value [, ...])</code></pre>
        <pre><code class="sql">LEAST(value [, ...])</code></pre>
        <pre class="next"><code class="sql">
SELECT a,
   CASE WHEN a=1 THEN 'one'
        WHEN a=2 THEN 'two'
        ELSE 'other'
   END
FROM test;
</code></pre>
    </div>
</section>

<section class="slide">
    <h2>ORDER BY. Сортировка</h2>
    <pre><code class="sql" style="font-size: 80%">SELECT select_list
FROM table_expression
ORDER BY sort_expression1 [ASC | DESC] [NULLS { FIRST | LAST }]
      [, sort_expression2 [ASC | DESC] [NULLS { FIRST | LAST }] ...]
</code></pre>
    <div style="font-size: 90%">
    <pre><code class="sql next">
SELECT a, b FROM table1 ORDER BY a + b, c;
</code></pre>
        <pre><code class="sql next">
SELECT a + b AS sum, c FROM table1 ORDER BY sum;
SELECT a, max(b) FROM table1 GROUP BY a ORDER BY 1;
</code></pre>
        <pre><code class="sql next">
# SELECT a + b AS sum, c FROM table1 ORDER BY sum + c;
ERROR:  column "sum" does not exist
LINE 1: SELECT a + b AS sum, c FROM table1 ORDER BY sum + c;
                                                    ^
</code></pre>
    </div>
</section>

<section class="slide">
    <h2>GROUP BY. Формирование групп</h2>
    <ul>
        <li>Группировка по одному столбцу</li>
        <li>Группировка по нескольким столбцам</li>
        <li>Группировка посредством выражений</li>
    </ul>
</section>

<section class="slide">
    <h2>GROUP BY. Формирование групп</h2>
    <pre><code class="sql">SELECT * FROM employee;</code></pre>
    <table class="classic bordered" style="font-size: 75%">
        <thead>
        <tr>
            <th>id</th>
            <th>name</th>
            <th>department</th>
            <th>grade</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>1</td>
            <td>John</td>
            <td>HR</td>
            <td>A</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Mark</td>
            <td>HR</td>
            <td>A</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Smit</td>
            <td>IT</td>
            <td>A</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Lili</td>
            <td>IT</td>
            <td>B</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Alex</td>
            <td>PR</td>
            <td>B</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Walton</td>
            <td>HR</td>
            <td>B</td>
        </tr>
        <tr>
            <td>7</td>
            <td>Kim</td>
            <td>PR</td>
            <td>B</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Marry</td>
            <td>HR</td>
            <td>A</td>
        </tr>
        <tr>
            <td>9</td>
            <td>Paul</td>
            <td>PR</td>
            <td>C</td>
        </tr>
        <tr>
            <td>10</td>
            <td>Christ</td>
            <td>HR</td>
            <td>A</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Jiji</td>
            <td>HR</td>
            <td>B</td>
        </tr>
        <tr>
            <td>12</td>
            <td>Bob</td>
            <td>PR</td>
            <td>B</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>GROUP BY. Формирование групп</h2>
    <pre><code class="sql">SELECT grade, department, COUNT(*)
FROM employee
GROUP BY grade, department
ORDER BY grade, department;
</code></pre>
    <table class="classic bordered" style="font-size: 75%">
        <thead>
        <tr>
            <th>grade</th>
            <th>department</th>
            <th>COUNT(*)</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>A</td>
            <td>HR</td>
            <td>4</td>
        </tr>
        <tr>
            <td>A</td>
            <td>IT</td>
            <td>1</td>
        </tr>
        <tr>
            <td>B</td>
            <td>HR</td>
            <td>2</td>
        </tr>
        <tr>
            <td>B</td>
            <td>IT</td>
            <td>1</td>
        </tr>
        <tr>
            <td>B</td>
            <td>PR</td>
            <td>3</td>
        </tr>
        <tr>
            <td>C</td>
            <td>PR</td>
            <td>1</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Агрегаторы</h2>
    <pre><code class="sql">aggregate_name (
    [ ALL | DISTINCT ] expression [ , ... ]
    [ order_by_clause ]
) [ FILTER ( WHERE filter_clause ) ]</code></pre>
    <pre><code class="sql">
SELECT
  string_agg(name, ',' ORDER BY name),
  avg(age),
  count(*) FILTER (WHERE age BETWEEN 13 AND 19) AS teens
FROM persons;
</code></pre>
</section>

<section class="slide">
    <h2>Агрегаторы</h2>
    <table>
        <thead>
        <tr>
            <th>Функция</th>
            <th>Описание</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>avg(expression)</td>
            <td>Среднее арифметическое</td>
        </tr>
        <tr>
            <td>max(expression)</td>
            <td>Максимальное значение</td>
        </tr>
        <tr>
            <td>min(expression)</td>
            <td>Минимальное значение</td>
        </tr>
        <tr>
            <td>sum(expression)</td>
            <td>Сумма</td>
        </tr>
        <tr>
            <td>count(*)</td>
            <td>Кол-во строк</td>
        </tr>
        <tr>
            <td>count(expression)</td>
            <td>Кол-во не NULL-значений</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Агрегаторы</h2>
    <table>
        <thead>
        <tr>
            <th>Функция</th>
            <th>Описание</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>bit_and(expression)</td>
            <td>Битовое "И"</td>
        </tr>
        <tr>
            <td>bit_or(expression)</td>
            <td>Битовое "ИЛИ"</td>
        </tr>
        <tr>
            <td>bool_and(expression), every(expression)</td>
            <td>Логическое "И"</td>
        </tr>
        <tr>
            <td>bool_or(expression)</td>
            <td>Логическое "ИЛИ"</td>
        </tr>
        <tr>
            <td>stddev(expression)</td>
            <td>Стандартное отклонение</td>
        </tr>
        <tr>
            <td>variance(expression)</td>
            <td>Дисперсия (квадрат отклонения)</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Агрегаторы</h2>
    <table>
        <thead>
        <tr>
            <th>Функция</th>
            <th>Описание</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>array_agg(expression)
            <td>Сформировать массив значений</td>
        </tr>
        <tr>
            <td>json_agg(expression)</td>
            <td>Сформировать JSON-массив</td>
        </tr>
        <tr>
            <td>jsonb_agg(expression)</td>
            <td>Сформировать JSONB-массив</td>
        </tr>
        <tr>
            <td>json_object_agg(key, value)</td>
            <td>Сформировать JSON-объект</td>
        </tr>
        <tr>
            <td>jsonb_object_agg(key, value)</td>
            <td>Сформировать JSONB-объект</td>
        </tr>
        <tr>
            <td>string_agg(expression, delimiter)</td>
            <td>Конкатенация строк</td>
        </tr>
        <tr>
            <td>xmlagg(expression)</td>
            <td>Конкатенация XML-элементов</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>HAVING. Фильтрация после группировки</h2>
    <pre><code class="sql">SELECT grade, department, COUNT(*)
FROM employee
GROUP BY grade, department
HAVING COUNT(*) > 3;
</code></pre>
    <pre><code class="next sql">
SELECT * FROM (
    SELECT grade, department, COUNT(*) as employee_cnt
    FROM employee
    GROUP BY grade, department
) a
WHERE employee_cnt > 3;
</code></pre>
</section>

<section class="slide">
    <h2>LIMIT. Разбивка на страницы</h2>
    <h3>ISO SQL:2003 - Window Functions:</h3>
    <div style="font-size: 80%">
    <pre><code class="sql">SELECT * FROM (
  SELECT
    ROW_NUMBER() OVER (ORDER BY age ASC) AS rownumber,
    person_id, person_name, age
  FROM person
) AS foo
WHERE rownumber <= 10;
</code></pre>
        <pre><code class="sql next">
SELECT * FROM (
  SELECT
    RANK() OVER (ORDER BY age ASC) AS ranking,
    person_id, person_name, age
  FROM person
) AS foo
WHERE ranking <= 10;
</code></pre>
    </div>
</section>

<section class="slide">
    <h2>LIMIT. Разбивка на страницы</h2>
    <h3>Синтаксис MySQL:</h3>
    <pre><code class="sql" style="font-size: 80%">SELECT
  person_id, person_name, age
FROM person
LIMIT 10
OFFSET 20;
</code></pre>
    <h3>Синтаксис DB2:</h3>
    <pre><code class="sql" style="font-size: 80%">SELECT
  person_id, person_name, age
FROM person
FETCH FIRST 10 ROWS ONLY;
</code></pre>
    <h3>PostgreSQL поддерживает оба синтаксиса</h3>
</section>

<section class="slide">
    <h2>SUBQUERIES</h2>
    <pre style="font-size: 90%"><code class="sql">
SELECT
    col0,
    (SELECT col1 FROM table1 WHERE table1.id = table0.id),
    (SELECT col2 FROM table1 WHERE table1.id = table0.id)
FROM
    table0;

SELECT *
FROM t1
WHERE column1 = (SELECT MAX(column2) FROM t2);

SELECT *
FROM t1 AS t
WHERE 2 = (SELECT COUNT(*) FROM t1 WHERE t1.id = t.id);</code></pre>
</section>

<section class="slide">
    <h2>SUBQUERIES</h2>
    <h3>Коррелирующий подзапрос</h3>
    <p style="font-size: 80%">
        Это подзапрос, который содержит ссылку на столбцы из включающего его запроса (назовем его основным).
        Таким образом, коррелирующий подзапрос будет выполняться для каждой строки основного запроса,
        так как значения столбцов основного запроса будут меняться.
    </p>

    Коррелирующий:
    <pre style="font-size: 90%"><code class="sql">
SELECT *
FROM t1 AS t
WHERE 2 = (SELECT COUNT(*) FROM t1 WHERE t1.id = t.id);</code></pre>
    Не коррелирующий:
    <pre style="font-size: 90%"><code class="sql">
SELECT *
FROM t1
WHERE column1 = (SELECT MAX(column2) FROM t2);</code></pre>

</section>

<section class="slide">
    <h2>SUBQUERIES: Expressions</h2>
    <ul class="compact">
        <li>EXISTS (subquery)
        <li>expression [NOT] IN (subquery)
        <li>expression operator ANY/SOME (subquery)
        <li>expression operator ALL (subquery)
    </ul>
    <pre style="font-size: 90%"><code class="sql">SELECT s1 FROM t1 WHERE s1 > ANY (SELECT s1 FROM t2);

SELECT s1 FROM t1 WHERE s1 = ANY (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 IN (SELECT s1 FROM t2);

SELECT s1 FROM t1 WHERE s1 > ALL (SELECT s1 FROM t2);

SELECT s1 FROM t1 WHERE s1 <> ALL (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 NOT IN (SELECT s1 FROM t2);
</code></pre>
</section>

<section class="slide">
    <h2>ROW SUBQUERIES</h2>
    <pre style="font-size: 90%"><code class="sql">SELECT *
FROM t1
WHERE (col1, col2)
	= (SELECT col3, col4 FROM t2 WHERE id = 10);
SELECT *
FROM t1
WHERE ROW (col1, col2)
	= (SELECT col3, col4 FROM t2 WHERE id = 10);

SELECT column1, column2, column3
FROM t1
WHERE (column1, column2, column3)
    IN (SELECT column1, column2, column3 FROM t2);
</code></pre>
</section>

<section class="slide">
    <h2>[NOT] EXISTS</h2>
    <pre style="font-size: 90%"><code class="sql">SELECT DISTINCT store_type
FROM stores
WHERE EXISTS (
    SELECT *
    FROM cities_stores
    WHERE cities_stores.store_type = stores.store_type
);
SELECT DISTINCT store_type
FROM stores
WHERE NOT EXISTS (
    SELECT *
    FROM cities_stores
    WHERE cities_stores.store_type = stores.store_type
);
</code></pre>
</section>

<section class="slide">
    <h2>SUBQUERIES in FROM</h2>
    <pre style="font-size: 90%"><code class="sql">SELECT ... FROM (subquery) [AS] name ...
SELECT AVG(sum_column1)
FROM (
    SELECT SUM(column1) AS sum_column1
    FROM t1
    GROUP BY column1
) AS t1;
</code></pre>
</section>

<section class="slide">
    <h2>UNION</h2>
    <div style="display: table; width: 100%">
        <div style="display: table-cell; width: 50%; padding: 10px">
<pre style="font-size: 80%"><code class="sql">SELECT ...
UNION [ALL | DISTINCT]
SELECT ...
[UNION [ALL | DISTINCT]
SELECT ...]
</code></pre>
        </div>
        <div style="display: table-cell; padding: 10px">
            <table class="classic bordered" style="font-size: 75%">
                <thead>
                <tr>
                    <th>person</th>
                    <th>amount</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Joe</td>
                    <td>1000</td>
                </tr>
                <tr>
                    <td>Alex</td>
                    <td>2000</td>
                </tr>
                <tr>
                    <td>Bob</td>
                    <td>5000</td>
                </tr>
                </tbody>
            </table>
        </div>
        <div style="display: table-cell; padding: 10px">
            <table class="classic bordered" style="font-size: 75%">
                <thead>
                <tr>
                    <th>person</th>
                    <th>amount</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Joe</td>
                    <td>2000</td>
                </tr>
                <tr>
                    <td>Alex</td>
                    <td>2000</td>
                </tr>
                <tr>
                    <td>Zach</td>
                    <td>35000</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div style="display: table; width: 100%">
        <div style="display: table-cell; width: 50%; padding: 10px">
    <pre><code style="font-size: 80%" class="sql">SELECT * FROM sales2010
UNION
SELECT * FROM sales2011;
</code></pre>
            <table class="classic bordered" style="font-size: 75%">
                <thead>
                <tr>
                    <th>person</th>
                    <th>amount</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Alex</td>
                    <td>2000</td>
                </tr>
                <tr>
                    <td>Bob</td>
                    <td>5000</td>
                </tr>
                <tr>
                    <td>Joe</td>
                    <td>1000</td>
                </tr>
                <tr>
                    <td>Joe</td>
                    <td>2000</td>
                </tr>
                <tr>
                    <td>Zach</td>
                    <td>35000</td>
                </tr>
                </tbody>
            </table>
        </div>
        <div style="display: table-cell; width: 50%; padding: 10px">
    <pre style="font-size: 80%"><code class="sql">SELECT * FROM sales2010
UNION ALL
SELECT * FROM sales2011;
</code></pre>
            <table class="classic bordered" style="font-size: 75%">
                <thead>
                <tr>
                    <th>person</th>
                    <th>amount</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Joe</td>
                    <td>1000</td>
                </tr>
                <tr>
                    <td>Alex</td>
                    <td>2000</td>
                </tr>
                <tr>
                    <td>Bob</td>
                    <td>5000</td>
                </tr>
                <tr>
                    <td>Joe</td>
                    <td>2000</td>
                </tr>
                <tr>
                    <td>Alex</td>
                    <td>2000</td>
                </tr>
                <tr>
                    <td>Zach</td>
                    <td>35000</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>

<section class="slide">
    <h2 class="shout">Объединения таблиц (JOIN)</h2>
</section>

<section class="slide white">
    <img src="../common/joins.svg" class="cover"/>
</section>

<section class="slide">
    <h2>Набор данных</h2>
    <div style="display: table; width: 100%">
        <div style="display: table-cell; width: 50%; padding: 10px">
            <table class="classic bordered" style="font-size: 80%">
                <thead>
                <tr>
                    <th colspan="2">Employee</th>
                </tr>
                <tr>
                    <th>LastName</th>
                    <th>DepartmentID</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Rafferty</td>
                    <td>31</td>
                </tr>
                <tr>
                    <td>Jones</td>
                    <td>33</td>
                </tr>
                <tr>
                    <td>Steinberg</td>
                    <td>33</td>
                </tr>
                <tr>
                    <td>Robinson</td>
                    <td>34</td>
                </tr>
                <tr>
                    <td>Smith</td>
                    <td>34</td>
                </tr>
                <tr>
                    <td>John</td>
                    <td>
                        <null/>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div style="display: table-cell; width: 50%; padding: 10px">
            <table class="classic bordered" style="font-size: 80%">
                <thead>
                <tr>
                    <th colspan="2">Department</th>
                </tr>
                <tr>
                    <th>DepartmentID</th>
                    <th>DepartmentName</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>31</td>
                    <td>Sales</td>
                </tr>
                <tr>
                    <td>33</td>
                    <td>Engineering</td>
                </tr>
                <tr>
                    <td>34</td>
                    <td>Clerical</td>
                </tr>
                <tr>
                    <td>35</td>
                    <td>Marketing</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>

<section class="slide">
    <h2>CROSS JOIN</h2>
    <pre style="font-size: 80%"><code class="sql">SELECT * FROM Employee CROSS JOIN Department;
</code></pre>
    <table class="classic bordered" style="font-size: 45%">
        <thead>
        <tr>
            <th>Employee.<br/>LastName</th>
            <th>Employee.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentName</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>CROSS JOIN</h2>
    <pre style="font-size: 80%"><code class="sql">SELECT * FROM Employee, Department;
</code></pre>
    <table class="classic bordered" style="font-size: 45%">
        <thead>
        <tr>
            <th>Employee.<br/>LastName</th>
            <th>Employee.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentName</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>INNER JOIN</h2>
    <img style="position: absolute; right: 20px; bottom: 20px" src="join-inner.svg">
    <pre style="font-size: 80%"><code class="sql">SELECT *
FROM Employee
INNER JOIN Department
ON Employee.DepartmentID = Department.DepartmentID;
</code></pre>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>Employee.<br/>LastName</th>
            <th>Employee.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentName</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>INNER JOIN</h2>
    <img style="position: absolute; right: 20px; bottom: 20px" src="join-inner.svg">
    <pre style="font-size: 80%"><code class="sql">SELECT *
FROM Employee, Department
WHERE Employee.DepartmentID = Department.DepartmentID;

</code></pre>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>Employee.<br/>LastName</th>
            <th>Employee.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentName</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>NATURAL JOIN</h2>
    <img style="position: absolute; right: 20px; bottom: 20px" src="join-inner.svg">
    <pre style="font-size: 80%"><code class="sql">SELECT *
FROM Employee
NATURAL JOIN Department;

</code></pre>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>DepartmentID</th>
            <th>Employee.<br/>LastName</th>
            <th>Department.<br/>DepartmentName</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>31</td>
            <td>Rafferty</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Jones</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Steinberg</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>34</td>
            <td>Robinson</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>34</td>
            <td>Smith</td>
            <td>Clerical</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>JOIN USING</h2>
    <img style="position: absolute; right: 20px; bottom: 20px" src="join-inner.svg">
    <pre style="font-size: 80%"><code class="sql">SELECT *
FROM Employee
JOIN Department USING (DepartmentID);

</code></pre>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>DepartmentID</th>
            <th>Employee.<br/>LastName</th>
            <th>Department.<br/>DepartmentName</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>31</td>
            <td>Rafferty</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Jones</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>33</td>
            <td>Steinberg</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>34</td>
            <td>Robinson</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>34</td>
            <td>Smith</td>
            <td>Clerical</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>LEFT OUTER JOIN</h2>
    <img style="position: absolute; right: 20px; bottom: 20px" src="join-left.svg">
    <pre style="font-size: 80%"><code class="sql">SELECT *
FROM Employee
LEFT OUTER JOIN Department
ON Employee.DepartmentID = Department.DepartmentID;
</code></pre>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>Employee.<br/>LastName</th>
            <th>Employee.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentName</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>
                <null/>
            </td>
            <td>
                <null/>
            </td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>RIGHT OUTER JOIN</h2>
    <img style="position: absolute; right: 20px; bottom: 20px" src="join-right.svg">
    <pre style="font-size: 80%"><code class="sql">SELECT Employee.*, Department.*
FROM Department
RIGHT OUTER JOIN Employee
ON Employee.DepartmentID = Department.DepartmentID;
</code></pre>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>Employee.<br/>LastName</th>
            <th>Employee.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentName</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>
                <null/>
            </td>
            <td>
                <null/>
            </td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>FULL OUTER JOIN</h2>
    <img style="position: absolute; right: 20px; bottom: 20px" src="join-full.svg">
    <pre style="font-size: 80%"><code class="sql">SELECT *
FROM Employee
FULL OUTER JOIN Department
ON Employee.DepartmentID = Department.DepartmentID;
</code></pre>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>Employee.<br/>LastName</th>
            <th>Employee.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentID</th>
            <th>Department.<br/>DepartmentName</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Rafferty</td>
            <td>31</td>
            <td>31</td>
            <td>Sales</td>
        </tr>
        <tr>
            <td>Jones</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>Steinberg</td>
            <td>33</td>
            <td>33</td>
            <td>Engineering</td>
        </tr>
        <tr>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>
                <null/>
            </td>
            <td>
                <null/>
            </td>
        </tr>
        <tr>
            <td>Robinson</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>Smith</td>
            <td>34</td>
            <td>34</td>
            <td>Clerical</td>
        </tr>
        <tr>
            <td>
                <null/>
            </td>
            <td>
                <null/>
            </td>
            <td>35</td>
            <td>Marketing</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>FULL OUTER JOIN</h2>
    <img style="position: absolute; right: 20px; bottom: 20px" src="join-full.svg">
    <pre style="font-size: 80%"><code class="sql">SELECT *
FROM Employee
FULL OUTER JOIN Department
ON Employee.DepartmentID = Department.DepartmentID;
</code></pre>
    <pre class="next" style="font-size: 80%"><code class="sql">
SELECT *
FROM Employee
LEFT OUTER JOIN Department
ON Employee.DepartmentID = Department.DepartmentID;
UNION ALL
SELECT *
FROM Employee
RIGHT OUTER JOIN Department
ON Employee.DepartmentID = Department.DepartmentID
WHERE Employee.DepartmentID IS NULL;
</code></pre>
</section>

<section class="slide">
    <h2>SELF-JOIN</h2>
    <pre style="font-size: 80%"><code class="sql">SELECT F.EmployeeID, F.LastName, S.EmployeeID, S.LastName, F.Country
FROM Employee F
INNER JOIN Employee S ON F.Country = S.Country
<span class="next">WHERE F.EmployeeID < S.EmployeeID
ORDER BY F.EmployeeID, S.EmployeeID;</span>
</code></pre>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>EmployeeID</th>
            <th>LastName</th>
            <th>DepartmentID</th>
            <th>Country</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>123</td>
            <td>Rafferty</td>
            <td>31</td>
            <td>Australia</td>
        </tr>
        <tr>
            <td>124</td>
            <td>Jones</td>
            <td>33</td>
            <td>Australia</td>
        </tr>
        <tr>
            <td>145</td>
            <td>Steinberg</td>
            <td>33</td>
            <td>Australia</td>
        </tr>
        <tr>
            <td>201</td>
            <td>Robinson</td>
            <td>34</td>
            <td>United States</td>
        </tr>
        <tr>
            <td>305</td>
            <td>Smith</td>
            <td>34</td>
            <td>Germany</td>
        </tr>
        <tr>
            <td>306</td>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>Germany</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>SELF-JOIN</h2>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>EmployeeID</th>
            <th>LastName</th>
            <th>DepartmentID</th>
            <th>Country</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>123</td>
            <td>Rafferty</td>
            <td>31</td>
            <td>Australia</td>
        </tr>
        <tr>
            <td>124</td>
            <td>Jones</td>
            <td>33</td>
            <td>Australia</td>
        </tr>
        <tr>
            <td>145</td>
            <td>Steinberg</td>
            <td>33</td>
            <td>Australia</td>
        </tr>
        <tr>
            <td>201</td>
            <td>Robinson</td>
            <td>34</td>
            <td>United States</td>
        </tr>
        <tr>
            <td>305</td>
            <td>Smith</td>
            <td>34</td>
            <td>Germany</td>
        </tr>
        <tr>
            <td>306</td>
            <td>John</td>
            <td>
                <null/>
            </td>
            <td>Germany</td>
        </tr>
        </tbody>
    </table>
    <table class="classic bordered" style="font-size: 80%">
        <thead>
        <tr>
            <th>F.EmployeeID</th>
            <th>F.LastName</th>
            <th>S.EmployeeID</th>
            <th>S.LastName</th>
            <th>F.Country</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>123</td>
            <td>Rafferty</td>
            <td>124</td>
            <td>Jones</td>
            <td>Australia</td>
        </tr>
        <tr>
            <td>123</td>
            <td>Rafferty</td>
            <td>145</td>
            <td>Steinberg</td>
            <td>Australia</td>
        </tr>
        <tr>
            <td>124</td>
            <td>Jones</td>
            <td>145</td>
            <td>Steinberg</td>
            <td>Australia</td>
        </tr>
        <tr>
            <td>305</td>
            <td>Smith</td>
            <td>306</td>
            <td>John</td>
            <td>Germany</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>SUBQUERIES vs JOIN</h2>
    <h3>Коррелирующий подзапрос</h3>
    <pre style="font-size: 75%"><code class="sql">SELECT E.*
FROM Employee E WHERE EXISTS (
  SELECT *
  FROM Department D WHERE D.DepartmentID = E.DepartmentID
);
</code></pre>
    <h3>Не коррелирующий подзапрос</h3>
    <pre style="font-size: 75%"><code class="sql">SELECT E.*
FROM Employee E WHERE E.DepartmentID IN (
  SELECT DepartmentID
  FROM Department D
);
</code></pre>
    <h3>JOIN</h3>
    <pre style="font-size: 75%"><code class="sql">SELECT E.*
FROM Employee E
JOIN Department D ON (E.DepartmentID = D.DepartmentID);
</code></pre>
</section>

<section class="slide">
    <h2>FAKE TABLE</h2>
    <table class="classic bordered" style="width: 150px; position: absolute; right: 50px">
        <thead>
        <tr>
            <th>n</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>1</td>
        </tr>
        <tr>
            <td>2</td>
        </tr>
        <tr>
            <td>3</td>
        </tr>
        <tr>
            <td>4</td>
        </tr>
        <tr>
            <td>5</td>
        </tr>
        </tbody>
    </table>
    <pre><code class="sql">SELECT 1 AS n
UNION ALL
SELECT 2
UNION ALL
SELECT 3
UNION ALL
SELECT 4
UNION ALL
SELECT 5;
</code></pre>

</section>

<section class="slide">
    <h2>FAKE TABLE</h2>
    <table class="classic bordered" style="width: 150px; position: absolute; right: 50px">
        <thead>
        <tr>
            <th>n</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>1</td>
        </tr>
        <tr>
            <td>2</td>
        </tr>
        <tr>
            <td>3</td>
        </tr>
        <tr>
            <td>4</td>
        </tr>
        <tr>
            <td>5</td>
        </tr>
        </tbody>
    </table>
    <pre><code class="sql">WITH RECURSIVE series(n) AS (
  SELECT 1
  UNION ALL
  SELECT n + 1 FROM series WHERE n < 5
)
SELECT * FROM series ORDER BY n;
</code></pre>
    <pre><code class="sql next">
SELECT n FROM unnest(ARRAY[
    1, 2, 3, 4, 5
]) n ORDER BY n;
</code></pre>
    <pre><code class="sql next">
SELECT n
FROM generate_series(1, 5) n;
</code></pre>
</section>

<section class="slide">
    <h2>FAKE TABLE</h2>
    <table class="classic bordered" style="width: 250px; position: absolute; right: 50px">
        <thead>
        <tr>
            <th>a</th>
            <th>b</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>1</td>
            <td>foo</td>
        </tr>
        <tr>
            <td>2</td>
            <td>bar</td>
        </tr>
        <tr>
            <td>3</td>
            <td>baz</td>
        </tr>
        </tbody>
    </table>
    <pre><code class="sql next">SELECT * FROM unnest(ARRAY[
    1, 2, 3
], ARRAY[
    'foo', 'bar', 'baz'
]) n (a, b) ORDER BY a;
</code></pre>
    <pre><code class="sql next">
SELECT * FROM (
  VALUES (1, 'foo'), (2, 'bar'), (3, 'baz')
) n (a, b)
</code></pre>
</section>

<section class="slide">
    <h2>Получение идентификаторов до вставки</h2>
    <pre><code class="sql">CREATE TABLE city (
    id bigserial NOT NULL PRIMARY KEY,
    region_id bigint NOT NULL,
    name varchar(128) NOT NULL
);

SELECT nextval(pg_get_serial_sequence('city', 'id'));
</code></pre>
    <pre><code class="sql next">
SELECT nextval(pg_get_serial_sequence('city', 'id'))
FROM generate_series(1, 100);
</code></pre>
</section>

<section class="slide">
    <h2>SELF UNION</h2>
    <pre><code class="sql">SELECT col1 FROM tbl
UNION ALL
SELECT col2 FROM tbl;
</code></pre>
    <pre><code class="sql next">
SELECT unnest(array[col1, col2]) as col1 FROM tbl;
</code></pre>
</section>

<section class="slide">
    <h2>WITH (Common Table Expressions)</h2>
    <pre><code class="sql" style="font-size: 70%">WITH regional_sales AS (
        SELECT region, SUM(amount) AS total_sales
        FROM orders
        GROUP BY region
     ),
     top_regions AS (
        SELECT region
        FROM regional_sales
        WHERE total_sales > (SELECT SUM(total_sales)/10 FROM regional_sales)
     )
SELECT region,
       product,
       SUM(quantity) AS product_units,
       SUM(amount) AS product_sales
FROM orders
WHERE region IN (SELECT region FROM top_regions)
GROUP BY region, product;
</code></pre>
</section>

<section class="slide">
    <h2>WITH (Common Table Expressions)</h2>
    <p style="font-size: 80%">Главный плюс и минус CTE в том, что запрос описанный в WITH будет вычисляться единожды ДО выполнения основного запроса.</p>
    <p style="font-size: 80%">Если запрос WITH является нерекурсивным и не имеет побочных эффектов, он может быть свёрнут в родительский запрос, что позволит оптимизировать совместно два уровня запросов.</p>
    <p style="font-size: 80%">По-умолчанию это происходит, только если запрос WITH задействуется в родительском запросе всего в одном месте, а не в нескольких.</p>
    <pre><code class="sql" style="font-size: 70%">WITH w AS (
    SELECT * FROM big_table
)
SELECT * FROM w WHERE key = 123;</code></pre>
    <p class="next" style="font-size: 80%">Будет аналогичен:</p>
    <pre class="next"><code class="sql" style="font-size: 70%">SELECT * FROM big_table WHERE key = 123;
</code></pre>
</section>

<section class="slide">
    <h2>WITH RECURSIVE</h2>
    <pre><code class="sql" style="font-size: 80%">WITH RECURSIVE recursetree (id, parent_id, level, name) AS (
    SELECT id, parent_id, 0, name FROM tree
    WHERE parent_id = 0
  UNION ALL
    SELECT t.id, t.parent_id, level+1, t.name
    FROM tree t
    JOIN recursetree rt ON rt.id = t.parent_id
  )
SELECT * FROM recursetree;

</code></pre>
    <table class="classic bordered" style="font-size: 67%">
        <thead>
        <tr>
            <th>id</th>
            <th>parent</th>
            <th>level</th>
            <th>name</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>1</td>
            <td>0</td>
            <td>0</td>
            <td>Россия</td>
        </tr>
        <tr>
            <td>2</td>
            <td>0</td>
            <td>0</td>
            <td>США</td>
        </tr>
        <tr>
            <td>3</td>
            <td>1</td>
            <td>1</td>
            <td>Москва</td>
        </tr>
        <tr>
            <td>4</td>
            <td>2</td>
            <td>1</td>
            <td>Нью Йорк</td>
        </tr>
        <tr>
            <td>5</td>
            <td>2</td>
            <td>1</td>
            <td>Вашингтон</td>
        </tr>
        <tr>
            <td>6</td>
            <td>3</td>
            <td>2</td>
            <td>Бутово</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>WITH RECURSIVE</h2>
    <pre><code class="sql" style="font-size: 80%">WITH RECURSIVE recursetree (id, path, name) AS (
    SELECT id, array_append('{}'::int[], id), name FROM tree
    WHERE parent_id = 0
  UNION ALL
    SELECT t.id, array_append(path, t.id), t.name
    FROM tree t
    JOIN recursetree rt ON rt.id = t.parent_id
  )
SELECT id, array_to_string(path, '.') as path, name FROM recursetree
ORDER BY path;
</code></pre>
    <table class="classic bordered next" style="font-size: 67%">
        <thead>
        <tr>
            <th>id</th>
            <th>path</th>
            <th>name</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>1</td>
            <td>1</td>
            <td>Россия</td>
        </tr>
        <tr>
            <td>3</td>
            <td>1.3</td>
            <td>Москва</td>
        </tr>
        <tr>
            <td>6</td>
            <td>1.3.6</td>
            <td>Бутово</td>
        </tr>
        <tr>
            <td>2</td>
            <td>2</td>
            <td>США</td>
        </tr>
        <tr>
            <td>4</td>
            <td>2.4</td>
            <td>Нью Йорк</td>
        </tr>
        <tr>
            <td>5</td>
            <td>2.5</td>
            <td>Вашингтон</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>WITH RECURSIVE</h2>
    <pre><code class="sql" style="font-size: 80%">WITH RECURSIVE t(n) AS (
    VALUES (1)
    UNION ALL
    SELECT n+1 FROM t WHERE n < 100
)
SELECT sum(n) FROM t;
    </code></pre>
    <table class="classic bordered next" style="font-size: 67%">
        <thead>
        <tr>
            <th>sum</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>5050</td>
        </tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2 class="shout">Иерархические структуры в базах данных</h2>
</section>

<section class="slide">
    <h2>Список смежных вершин (Adjacency List)</h2>
    <div style="text-align: center; height: 100%">
        <img style="height: 70%" src="categories.png"/>
    </div>
</section>

<section class="slide">
    <h2>Список смежных вершин (Adjacency List)</h2>
    <div style="font-size: 80%">
    <pre><code class="sql">
CREATE TABLE IF NOT EXISTS category(
    id     serial primary key,
    name   varchar(20) not null,
    parent int default null references category (id)
);

INSERT INTO category VALUES
        (1,'ELECTRONICS',NULL),
        (2,'TELEVISIONS',1),(3,'TUBE',2),
        (4,'LCD',2),
        (5,'PLASMA',2),
        (6,'PORTABLE ELECTRONICS',1),
        (7,'MP3 PLAYERS',6),
        (8,'FLASH',7),
        (9,'CD PLAYERS',6),
        (10,'2 WAY RADIOS',6);
</code></pre>
    </div>
</section>

<section class="slide">
    <h2>Список смежных вершин (Adjacency List)</h2>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT * FROM category ORDER BY id;
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr>
            <th>id</th>
            <th>name</th>
            <th>parent</th>
        </tr>
        </thead>
        <tbody>
        <tr><td>1</td><td>ELECTRONICS</td><td>null</td></tr>
        <tr><td>2</td><td>TELEVISIONS</td><td>1</td></tr>
        <tr><td>3</td><td>TUBE</td><td>2</td></tr>
        <tr><td>4</td><td>LCD</td><td>2</td></tr>
        <tr><td>5</td><td>PLASMA</td><td>2</td></tr>
        <tr><td>6</td><td>PORTABLE ELECTRONICS</td><td>1</td></tr>
        <tr><td>7</td><td>MP3 PLAYERS</td><td>6</td></tr>
        <tr><td>8</td><td>FLASH</td><td>7</td></tr>
        <tr><td>9</td><td>CD PLAYERS</td><td>6</td></tr>
        <tr><td>10</td><td>2 WAY RADIOS</td><td>6</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Список смежных вершин (Adjacency List)</h2>
    <h3>Получение всего дерева</h3>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT t1.name AS lvl1, t2.name as lvl2, t3.name as lvl3, t4.name as lvl4
FROM category AS t1
LEFT JOIN category AS t2 ON t2.parent = t1.id
LEFT JOIN category AS t3 ON t3.parent = t2.id
LEFT JOIN category AS t4 ON t4.parent = t3.id
WHERE t1.name = 'ELECTRONICS';
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>lvl1</th><th>lvl2</th><th>lvl3</th><th>lvl4</th></tr>
        </thead>
        <tbody>
        <tr><td>ELECTRONICS</td><td>PORTABLE ELECTRONICS</td><td>MP3 PLAYERS</td><td>FLASH</td></tr>
        <tr><td>ELECTRONICS</td><td>PORTABLE ELECTRONICS</td><td>2 WAY RADIOS</td><td>NULL</td></tr>
        <tr><td>ELECTRONICS</td><td>TELEVISIONS</td><td>PLASMA</td><td>NULL</td></tr>
        <tr><td>ELECTRONICS</td><td>TELEVISIONS</td><td>LCD</td><td>NULL</td></tr>
        <tr><td>ELECTRONICS</td><td>TELEVISIONS</td><td>TUBE</td><td>NULL</td></tr>
        <tr><td>ELECTRONICS</td><td>PORTABLE ELECTRONICS</td><td>CD PLAYERS</td><td>NULL</td></tr>
        </tbody>
    </table>
</section>
<section class="slide">
    <h2>Список смежных вершин (Adjacency List)</h2>
    <h3>Получение всего дерева рекурсивно</h3>
    <div style="font-size: 70%">
    <pre><code class="sql">
WITH RECURSIVE tree(id, name, parent, lvl) AS (
    SELECT t.id, t.name, t.parent, 0 from category t WHERE t.parent IS NULL
    UNION ALL
    SELECT t.id, t.name, t.parent, t1.lvl + 1 FROM category t
        JOIN tree AS t1 ON t1.id = t.parent
) SELECT CONCAT(REPEAT('-', lvl::int), name) FROM tree ORDER BY id;
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>name</th></tr>
        </thead>
        <tbody>
        <tr><td>ELECTRONICS</td></tr>
        <tr><td>-TELEVISIONS</td></tr>
        <tr><td>--TUBE</td></tr>
        <tr><td>--LCD</td></tr>
        <tr><td>--PLASMA</td></tr>
        <tr><td>-PORTABLE ELECTRONICS</td></tr>
        <tr><td>--MP3 PLAYERS</td></tr>
        <tr><td>---FLASH</td></tr>
        <tr><td>--CD PLAYERS</td></tr>
        <tr><td>--2 WAY RADIOS</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Список смежных вершин (Adjacency List)</h2>
    <h3>Получение листовых узлов</h3>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT t1.name
FROM category as t1
         LEFT JOIN category as t2 on t1.id = t2.parent
WHERE t2.id is null;
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>name</th></tr>
        </thead>
        <tbody>
            <tr><td>2 WAY RADIOS</td></tr>
            <tr><td>FLASH</td></tr>
            <tr><td>PLASMA</td></tr>
            <tr><td>LCD</td></tr>
            <tr><td>TUBE</td></tr>
            <tr><td>CD PLAYERS</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Список смежных вершин (Adjacency List)</h2>
    <h3>Получение одной ветви</h3>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT t1.name AS lvl1, t2.name as lvl2, t3.name as lvl3, t4.name as lvl4
FROM category AS t1
         LEFT JOIN category AS t2 ON t2.parent = t1.id
         LEFT JOIN category AS t3 ON t3.parent = t2.id
         LEFT JOIN category AS t4 ON t4.parent = t3.id
WHERE t1.name = 'ELECTRONICS' AND t4.name = 'FLASH';
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>lvl1</th><th>lvl2</th><th>lvl3</th><th>lvl4</th></tr>
        </thead>
        <tbody>
            <tr><td>ELECTRONICS</td><td>PORTABLE ELECTRONICS</td><td>MP3 PLAYERS</td><td>FLASH</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Список смежных вершин (Adjacency List)</h2>
    <h3>Получение путей рекурсивно</h3>
    <div style="font-size: 70%">
    <pre><code class="sql">
WITH RECURSIVE tree (id, path, name) AS (
    SELECT id, array[id], name FROM category WHERE parent is null
    UNION ALL
    SELECT t.id, array_append(path, t.id), t.name
        FROM category t JOIN tree rt ON rt.id = t.parent
)
SELECT array_to_string(path, '.') as path, name FROM tree ORDER BY path;
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>path</th><th>name</th></tr>
        </thead>
        <tbody>
            <tr><td>1</td><td>ELECTRONICS</td></tr>
            <tr><td>1.2</td><td>TELEVISIONS</td></tr>
            <tr><td>1.2.3</td><td>TUBE</td></tr>
            <tr><td>1.2.4</td><td>LCD</td></tr>
            <tr><td>1.2.5</td><td>PLASMA</td></tr>
            <tr><td>1.6</td><td>PORTABLE ELECTRONICS</td></tr>
            <tr><td>1.6.10</td><td>2 WAY RADIOS</td></tr>
            <tr><td>1.6.7</td><td>MP3 PLAYERS</td></tr>
            <tr><td>1.6.7.8</td><td>FLASH</td></tr>
            <tr><td>1.6.9</td><td>CD PLAYERS</td></tr>
    </table>
</section>

<section class="slide">
    <h2>Список смежных вершин (Adjacency List)</h2>
    <div style="font-size: 85%">
        <p><strong>-</strong> Главный недостаток такого подхода — необходимо достоверно знать количество уровней вложенности в вашей
            иерархии, кроме того, чем больше иерархия, тем больше JOIN'ов — тем ниже производительность.</p>
        <p><strong>+</strong> Тем не менее, данный способ обладает и существенными достоинствами — в дерево легко вносить изменения, менять
            местами и удалять узлы.</p>
        <p><strong>+</strong> Данный алгоритм хорошо применим, если вы оперируете с небольшими древовидными структурами, которые часто
            поддаются изменениям.</p>
        <p><strong>+</strong> Алгоритм также довольно уверенно себя чувствует и с большими деревьями, если считывать
            их порциями вида «знаю родителя — прочитать всех наследников». Хороший пример такого случая — динамически
            подгружаемые деревья.</p>
        <p><strong>-</strong> Но он плохо применим, когда нужно вычитывать какие-либо иные куски дерева, находить пути, предыдущие и
            следующие узлы при обходе и вычитывать ветки дерева целиком (на всю глубину).</p>
    </div>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <div style="text-align: center; height: 100%">
        <img style="margin-top: 100px;" src="nested_categories.png"/>
    </div>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <div style="text-align: center; height: 100%">
        <img style="margin-top: 100px;" src="nested_numbered.png"/>
    </div>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <div style="text-align: center; height: 100%">
        <img src="numbered_tree.png"/>
    </div>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <div style="font-size: 70%">
    <pre><code class="sql">
CREATE TABLE IF NOT EXISTS nested_category
(
    id   serial primary key,
    name text not null,
    lft  int  not null,
    rgt  int  not null
);

INSERT INTO nested_category
VALUES (1, 'ELECTRONICS', 1, 20),
       (2, 'TELEVISIONS', 2, 9),
       (3, 'TUBE', 3, 4),
       (4, 'LCD', 5, 6),
       (5, 'PLASMA', 7, 8),
       (6, 'PORTABLE ELECTRONICS', 10, 19),
       (7, 'MP3 PLAYERS', 11, 14),
       (8, 'FLASH', 12, 13),
       (9, 'CD PLAYERS', 15, 16),
       (10, '2 WAY RADIOS', 17, 18);
</code></pre>
    </div>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT * FROM nested_category ORDER BY id;
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>id</th><th>name</th><th>lft</th><th>rgt</th></tr>
        </thead>
        <tbody>
        <tr><td>1</td><td>ELECTRONICS</td><td>1</td><td>20</td></tr>
        <tr><td>2</td><td>TELEVISIONS</td><td>2</td><td>9</td></tr>
        <tr><td>3</td><td>TUBE</td><td>3</td><td>4</td></tr>
        <tr><td>4</td><td>LCD</td><td>5</td><td>6</td></tr>
        <tr><td>5</td><td>PLASMA</td><td>7</td><td>8</td></tr>
        <tr><td>6</td><td>PORTABLE ELECTRONICS</td><td>10</td><td>19</td></tr>
        <tr><td>7</td><td>MP3 PLAYERS</td><td>11</td><td>14</td></tr>
        <tr><td>8</td><td>FLASH</td><td>12</td><td>13</td></tr>
        <tr><td>9</td><td>CD PLAYERS</td><td>15</td><td>16</td></tr>
        <tr><td>10</td><td>2 WAY RADIOS</td><td>17</td><td>18</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT node.name
FROM nested_category AS node,
        nested_category AS parent
WHERE node.lft BETWEEN parent.lft AND parent.rgt
        AND parent.name = 'ELECTRONICS'
ORDER BY node.lft;
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>id</th><th>name</th><th>lft</th><th>rgt</th></tr>
        </thead>
        <tbody>
        <tr><td>1</td><td>ELECTRONICS</td><td>1</td><td>20</td></tr>
        <tr><td>2</td><td>TELEVISIONS</td><td>2</td><td>9</td></tr>
        <tr><td>3</td><td>TUBE</td><td>3</td><td>4</td></tr>
        <tr><td>4</td><td>LCD</td><td>5</td><td>6</td></tr>
        <tr><td>5</td><td>PLASMA</td><td>7</td><td>8</td></tr>
        <tr><td>6</td><td>PORTABLE ELECTRONICS</td><td>10</td><td>19</td></tr>
        <tr><td>7</td><td>MP3 PLAYERS</td><td>11</td><td>14</td></tr>
        <tr><td>8</td><td>FLASH</td><td>12</td><td>13</td></tr>
        <tr><td>9</td><td>CD PLAYERS</td><td>15</td><td>16</td></tr>
        <tr><td>10</td><td>2 WAY RADIOS</td><td>17</td><td>18</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <h3>Получение всего дерева</h3>
    <div style="font-size: 70%">
    <pre><code class="sql">
SELECT CONCAT(REPEAT('-', (COUNT(parent.name) - 1)::int), node.name) AS name
FROM nested_category AS node,
     nested_category AS parent
WHERE node.lft BETWEEN parent.lft AND parent.rgt
GROUP BY node.name, node.lft
ORDER BY node.lft;
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>name</th></tr>
        </thead>
        <tbody>
            <tr><td>ELECTRONICS</td></tr>
            <tr><td>-TELEVISIONS</td></tr>
            <tr><td>--TUBE</td></tr>
            <tr><td>--LCD</td></tr>
            <tr><td>--PLASMA</td></tr>
            <tr><td>-PORTABLE ELECTRONICS</td></tr>
            <tr><td>--MP3 PLAYERS</td></tr>
            <tr><td>---FLASH</td></tr>
            <tr><td>--CD PLAYERS</td></tr>
            <tr><td>--2 WAY RADIOS</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <h3>Получение листовых узлов</h3>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT name
FROM nested_category
WHERE rgt = lft + 1;
    </code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>name</th></tr>
        </thead>
        <tbody>
            <tr><td>TUBE</td></tr>
            <tr><td>LCD</td></tr>
            <tr><td>PLASMA</td></tr>
            <tr><td>FLASH</td></tr>
            <tr><td>CD PLAYERS</td></tr>
            <tr><td>2 WAY RADIOS</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <h3>Получение одной ветви</h3>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT parent.name
FROM nested_category AS node, nested_category AS parent
WHERE node.lft BETWEEN parent.lft AND parent.rgt AND node.name = 'FLASH'
ORDER BY parent.lft;
    </code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>name</th></tr>
        </thead>
        <tbody>
            <tr><td>ELECTRONICS</td></tr>
            <tr><td>PORTABLE ELECTRONICS</td></tr>
            <tr><td>MP3 PLAYERS</td></tr>
            <tr><td>FLASH</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Вложенное множество (Nested Set)</h2>
    <div>
        <p><strong>+</strong> Nested Set действительно хорош, когда нам необходимо считывать структуру деревьев из БД. При этом он
            одинаково хорош для деревьев любого объема.</p>
        <p><strong>-</strong> Тем не менее, для иерархических структур, которые подвергаются частому изменению он, очевидно, не будет
            являться оптимальным выбором.</p>
    </div>
</section>

<section class="slide">
    <h2>Материализованный путь (Materialized Path)</h2>
    <div style="text-align: center; height: 100%">
        <img style="height: 70%" src="categories.png"/>
    </div>
</section>

<section class="slide">
    <h2>Материализованный путь (Materialized Path)</h2>
    <div style="font-size: 70%">
    <pre><code class="sql">
CREATE TABLE IF NOT EXISTS materialized_category
(
    id   SERIAL PRIMARY KEY,
    name TEXT  NOT NULL,
    path INT[] NOT NULL
);

INSERT INTO materialized_category
VALUES (1, 'ELECTRONICS', '{1}'),
       (2, 'TELEVISIONS', '{1,2}'),
       (3, 'TUBE', '{1,2,3}'),
       (4, 'LCD', '{1,2,4}'),
       (5, 'PLASMA', '{1,2,5}'),
       (6, 'PORTABLE ELECTRONICS', '{1,6}'),
       (7, 'MP3 PLAYERS', '{1,6,7}'),
       (8, 'FLASH', '{1,6,7,8}'),
       (9, 'CD PLAYERS', '{1,6,9}'),
       (10, '2 WAY RADIOS', '{1,6,10}');
</code></pre>
    </div>
</section>

<section class="slide">
    <h2>Материализованный путь (Materialized Path)</h2>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT * FROM materialized_category ORDER BY id;
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>id</th><th>name</th><th>path</th></tr>
        </thead>
        <tbody>
        <tr><td>1</td><td>ELECTRONICS</td><td>{1}</td></tr>
        <tr><td>2</td><td>TELEVISIONS</td><td>{1,2}</td></tr>
        <tr><td>3</td><td>TUBE</td><td>{1,2,3}</td></tr>
        <tr><td>4</td><td>LCD</td><td>{1,2,4}</td></tr>
        <tr><td>5</td><td>PLASMA</td><td>{1,2,5}</td></tr>
        <tr><td>6</td><td>PORTABLE ELECTRONICS</td><td>{1,6}</td></tr>
        <tr><td>7</td><td>MP3 PLAYERS</td><td>{1,6,7}</td></tr>
        <tr><td>8</td><td>FLASH</td><td>{1,6,7,8}</td></tr>
        <tr><td>9</td><td>CD PLAYERS</td><td>{1,6,9}</td></tr>
        <tr><td>10</td><td>2 WAY RADIOS</td><td>{1,6,10}</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Материализованный путь (Materialized Path)</h2>
    <h3>Получение всего дерева</h3>
    <div style="font-size: 80%">
    <pre><code class="sql">
SELECT id,
        CONCAT(REPEAT('-', (ARRAY_LENGTH(path, 1) - 1)::int), name),
        path
FROM materialized_category;
</code></pre>
    </div>
    <table class="classic bordered next" style="font-size: 60%">
        <thead>
        <tr><th>id</th><th>name</th><th>path</th></tr>
        </thead>
        <tbody>
        <tr><td>1</td><td>ELECTRONICS</td><td>{1}</td></tr>
        <tr><td>2</td><td>-TELEVISIONS</td><td>{1,2}</td></tr>
        <tr><td>3</td><td>--TUBE</td><td>{1,2,3}</td></tr>
        <tr><td>4</td><td>--LCD</td><td>{1,2,4}</td></tr>
        <tr><td>5</td><td>--PLASMA</td><td>{1,2,5}</td></tr>
        <tr><td>6</td><td>-PORTABLE ELECTRONICS</td><td>{1,6}</td></tr>
        <tr><td>7</td><td>--MP3 PLAYERS</td><td>{1,6,7}</td></tr>
        <tr><td>8</td><td>---FLASH</td><td>{1,6,7,8}</td></tr>
        <tr><td>9</td><td>--CD PLAYERS</td><td>{1,6,9}</td></tr>
        <tr><td>10</td><td>--2 WAY RADIOS</td><td>{1,6,10}</td></tr>
        </tbody>
    </table>
</section>

<section class="slide">
    <h2>Материализованный путь (Materialized Path)</h2>
    <div style="font-size: 90%">
        <p><strong>+</strong> алгоритм довольно уверенно себя чувствует на достаточно больших объемах данных.</p>
        <p><strong>+</strong> удаление, добавление в конец или изменение узла — это операции довольно простые, и, как правило, не
        вызывают сложностей в данной модели.</p>
        <p><strong>-</strong> наиболее неприятной в данном алгоритме будет операция вставки узла в середину уже существующей структуры и
            перенос одной ветки в другую.</p>
        <p><strong>-</strong> эффективность алгоритма будет зависеть от конкретной реализации, например, от выбора типа данных для хранения пути</p>
        <br>
        <br>
        <p>Полезное расширение Postgres для самостоятельного изучения - <a href="https://www.postgresql.org/docs/current/ltree.html" target="_blank">ltree</a></p>
    </div>
</section>

<section class="slide">
    <h2>Комбинированный подход</h2>
    <p>Имеет смысл комбинировать следующие подходы:</p>
    <ul>
        <li>Списки смежности + материализованный путь (Adjacency List + Materialized Path)</li>
        <li>Списки смежности + вложенные множества (Adjacency List + Nested Set)</li>
    </ul>
    <p>Комбинировать же Nested Set и Materialized Path особого смысла не имеет, т.к. существенного выигрыша ни в
        чтении, ни в записи вы не получите.</p>
</section>

	
<section class="slide white" style="padding: 0" id="contacts">
    <svg
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="-10 -10 895 645"
            width="100%"
            height="100%"
            style="background-image: url(../park.mail.ru/img/back.png)"
            version="1.1">
        <image
                xlink:href="../park.mail.ru/img/blocks.svg"
                width="718"
                height="548"
                preserveAspectRatio="none"
                x="157"
                y="67"/>
		<image
                xlink:href="../park.mail.ru/img/logo.svg"
                width="297"
                height="130"
                preserveAspectRatio="none"
                x="0"
                y="0"/>
        <g style="font-family: 'PF Isotext Pro', sans-serif; font-size: 32px; font-stretch: semi-condensed">
            <foreignObject x="177" y="204" width="514" height="202">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: center">
                    <div style="vertical-align: middle; display: table-cell; padding-bottom: 20px; font-weight: bold">
                        Стрелков Никита
                        
                        
                        <div>E-mail: nikita.strelkov@gmail.com</div>
                        
                    </div>
                </div>
            </foreignObject>
            <foreignObject x="534" y="534" width="326" height="65">
                <div xmlns="http://www.w3.org/1999/xhtml"
                     style="height: 100%; width: 100%; display: table; text-align: center; font-size: 28px; font-weight: bold">
                    <div style="vertical-align: middle; display: table-cell">
                        Спасибо за внимание!
                    </div>
                </div>
            </foreignObject>
        <g>
    </svg>
</section>

	<div class="progress"></div>
	<script src="../js/common.js"></script>
	<script src="../shower/shower.min.js"></script>
	<script src="../highlight.js/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	



</body>
</html>
